<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>DarkSideTest</title>
  <meta name="description" content="Discover your hidden psychological archetype with DarkSideTest.">
  <link rel="manifest" href="manifest.json"/>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <!-- tsParticles -->
  <script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
  <style>
    @keyframes glow {
      0%,100% { text-shadow: 0 0 8px #ffe100; }
      50% { text-shadow: 0 0 16px #ffea00; }
    }
    .glow {
      animation: glow 2s infinite;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-primary to-black text-gray-100 font-sans min-h-screen overflow-hidden">
  <div id="tsparticles" class="absolute inset-0 -z-10"></div>
  <div class="relative flex items-center justify-center h-full p-4">
    <div class="backdrop-blur-lg bg-card bg-opacity-60 max-w-lg w-full rounded-3xl p-8 shadow-2xl space-y-6 animate__animated animate__fadeInDown">
      <header class="text-center space-y-2">
        <h1 class="text-6xl font-bold text-accent glow animate__animated animate__heartBeat animate__infinite">DarkSideTest</h1>
        <p class="text-gray-300 animate__animated animate__fadeInUp">Uncover your hidden psychological archetype</p>
      </header>
      <div id="start" class="space-y-4">
        <input id="user-name" type="text" placeholder="Enter your name" 
               class="w-full px-4 py-3 rounded-lg bg-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-accent transition"/>
        <button id="start-btn" class="w-full py-3 bg-gradient-to-r from-accent to-yellow-300 rounded-lg font-semibold text-primary hover:from-yellow-300 hover:to-accent transition animate__animated animate__pulse animate__infinite">
          Start Test
        </button>
      </div>
      <div id="quiz-container" class="hidden space-y-4">
        <div class="flex justify-between">
          <span id="greeting" class="text-xl font-medium animate__animated"></span>
          <span id="timer" class="text-xl font-bold animate__animated animate__flash animate__infinite"></span>
        </div>
        <div id="progress" class="w-full bg-gray-700 rounded-full h-2 overflow-hidden">
          <div id="bar" class="h-full bg-accent w-0 transition-all"></div>
        </div>
        <div id="quiz" class="space-y-4"></div>
      </div>
      <div id="result" class="hidden text-center space-y-4 animate__animated animate__zoomIn">
        <div class="flex justify-center mb-4">
          <img id="res-img" src="" alt="Archetype" class="w-32 h-32 rounded-full border-4 border-accent shadow-lg animate__animated animate__bounceIn"/>
        </div>
        <h2 id="res-text" class="text-xl font-semibold glow"></h2>
        <div class="flex justify-center space-x-3">
          <a id="tw" class="px-4 py-2 bg-blue-600 rounded-full hover:bg-blue-700 transition"><i class="fab fa-twitter animate__animated animate__bounce"></i></a>
          <a id="rd" class="px-4 py-2 bg-red-600 rounded-full hover:bg-red-700 transition"><i class="fab fa-reddit-alien animate__animated animate__bounce"></i></a>
        </div>
        <button id="copy-btn" class="mt-2 px-4 py-2 bg-green-600 rounded-full hover:bg-green-700 transition animate__animated animate__tada">
          <i class="fas fa-link mr-2"></i>Copy Link
        </button>
        <button id="retake-btn" class="w-full py-3 bg-gradient-to-r from-accent to-yellow-300 rounded-lg font-semibold text-primary hover:from-yellow-300 hover:to-accent transition animate__animated animate__fadeInUp">
          Retake Test
        </button>
      </div>
    </div>
  </div>
  <script>
    // Initialize particles background
    tsParticles.load('tsparticles', {
      particles: {
        number: { value: 80 }, shape: { type: 'circle' },
        color: { value: '#ffe100' }, opacity: { value: 0.5 },
        size: { value: { min: 1, max: 3 } }, move: { speed: 1 }
      }
    });

    // Service Worker
    if('serviceWorker' in navigator) navigator.serviceWorker.register('service-worker.js');

    const questions = [
      { type: 'mcq', text: "Someone disrespects you. How do you react?", options:[
          {text:"Stay silent & move on",type:"empath"},
          {text:"Smile & plan revenge",type:"manipulator"},
          {text:"Confront them boldly",type:"shadow"},
          {text:"Ignore, you have better things",type:"free"}
      ]},
      // ... other MCQ questions ...
      { type: 'range', text: "On a scale of 1-100, how much do you value freedom & adventure?" }
    ];
    const resultData = {
      shadow:{text:"You are the Shadow Master – deep & mysterious.",img:"https://via.placeholder.com/150"},
      manipulator:{text:"You are the Charming Manipulator – strategic & magnetic.",img:"https://via.placeholder.com/150"},
      empath:{text:"You are the Hidden Empath – caring & intuitive.",img:"https://via.placeholder.com/150"},
      free:{text:"You are the Free Spirit – adventurous & spontaneous.",img:"https://via.placeholder.com/150"}
    };
    let scores={shadow:0,manipulator:0,empath:0,free:0}, current=0, userName="", timer;

    // Start test
    document.getElementById('start-btn').onclick = ()=>{
      let input = document.getElementById('user-name');
      if(!input.value.trim()) return input.focus();
      userName = input.value.trim();
      document.getElementById('start').classList.add('hidden');
      document.getElementById('quiz-container').classList.remove('hidden');
      document.getElementById('greeting').innerText = `Hello, ${userName}!`;
      nextQuestion();
    };

    function updateProgress(){
      document.getElementById('bar').style.width = `${(current/questions.length)*100}%`;
    }
    function startTimer(){
      clearInterval(timer);
      let count = 15;
      document.getElementById('timer').innerText = count;
      timer = setInterval(()=>{
        count--;
        document.getElementById('timer').innerText = count;
        if(count<=0) select('');
      },1000);
    }
    function nextQuestion(){
      clearInterval(timer);
      if(current>=questions.length) return showResult();
      let q = questions[current], html = '';
      updateProgress();
      if(q.type==='mcq'){
        html = `<div class="bg-card p-4 rounded-lg animate__animated animate__fadeIn">` +
          `<h3 class="font-medium mb-3">${q.text}</h3>` +
          q.options.map(o=>`<button onclick="select('${o.type}')" class="w-full mb-2 px-4 py-2 bg-gray-700 rounded hover:bg-gray-600 transition animate__animated animate__pulse animate__slow">${o.text}</button>`).join('') +
          `</div>`;
      } else {
        html = `<div class="bg-card p-4 rounded-lg animate__animated animate__fadeIn">` +
          `<h3 class="font-medium mb-3">${q.text}</h3>` +
          `<input id="range-input" type="range" min="1" max="100" value="50" class="w-full mb-3"/>` +
          `<button onclick="selectRange()" class="w-full px-4 py-2 bg-accent rounded hover:bg-yellow-300 transition animate__animated animate__rubberBand animate__slow">Submit</button>` +
          `</div>`;
      }
      document.getElementById('quiz').innerHTML = html;
      startTimer();
    }
    function select(type){
      clearInterval(timer);
      if(type) scores[type]++;
      current++;
      nextQuestion();
    }
    function selectRange(){
      clearInterval(timer);
      let v = +document.getElementById('range-input').value;
      let idx = Math.min(3, Math.floor((v-1)/25));
      let map = ['empath','manipulator','shadow','free'];
      scores[map[idx]]++;
      current++;
      nextQuestion();
    }
    function showResult(){
      clearInterval(timer);
      let key = Object.keys(scores).reduce((a,b)=>scores[a]>scores[b]?a:b);
      let data = resultData[key];
      document.getElementById('quiz-container').classList.add('hidden');
      document.getElementById('result').classList.remove('hidden');
      document.getElementById('res-img').src = data.img;
      document.getElementById('res-text').innerText = data.text;
      let url = encodeURIComponent(window.location.href);
      document.getElementById('tw').href=`https://twitter.com/intent/tweet?text=${userName}+got+${key}!+Try:+${url}`;
      document.getElementById('rd').href=`https://reddit.com/submit?url=${url}&title=Which archetype are you?`;
      confetti({ particleCount: 200, spread: 100 });
    }
    document.getElementById('copy-btn').onclick = ()=>navigator.clipboard.writeText(window.location.href).then(()=>alert('Link copied!'));
    document.getElementById('retake-btn').onclick = ()=>{
      scores={shadow:0,manipulator:0,empath:0,free:0}; current=0;
      document.getElementById('result').classList.add('hidden');
      document.getElementById('quiz-container').classList.remove('hidden');
      nextQuestion();
    };
  </script>
</body>
</html>